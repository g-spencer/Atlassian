{"source":2,"revision":19,"description":null,"createdBy":{"displayName":"Gary Spencer","url":"https://spsprodweu3.vssps.visualstudio.com/Afa44433d-b15b-473b-8914-d9005ae75068/_apis/Identities/89473f32-ed72-6d4d-b136-f5a6d7ebac60","_links":{"avatar":{"href":"https://dev.azure.com/SIS-Betting/_apis/GraphProfile/MemberAvatars/aad.ODk0NzNmMzItZWQ3Mi03ZDRkLWIxMzYtZjVhNmQ3ZWJhYzYw"}},"id":"89473f32-ed72-6d4d-b136-f5a6d7ebac60","uniqueName":"gspencer@sis.tv","imageUrl":"https://dev.azure.com/SIS-Betting/_apis/GraphProfile/MemberAvatars/aad.ODk0NzNmMzItZWQ3Mi03ZDRkLWIxMzYtZjVhNmQ3ZWJhYzYw","descriptor":"aad.ODk0NzNmMzItZWQ3Mi03ZDRkLWIxMzYtZjVhNmQ3ZWJhYzYw"},"createdOn":"2021-11-26T12:29:12.033Z","modifiedBy":{"displayName":"Gary Spencer","url":"https://spsprodweu3.vssps.visualstudio.com/Afa44433d-b15b-473b-8914-d9005ae75068/_apis/Identities/89473f32-ed72-6d4d-b136-f5a6d7ebac60","_links":{"avatar":{"href":"https://dev.azure.com/SIS-Betting/_apis/GraphProfile/MemberAvatars/aad.ODk0NzNmMzItZWQ3Mi03ZDRkLWIxMzYtZjVhNmQ3ZWJhYzYw"}},"id":"89473f32-ed72-6d4d-b136-f5a6d7ebac60","uniqueName":"gspencer@sis.tv","imageUrl":"https://dev.azure.com/SIS-Betting/_apis/GraphProfile/MemberAvatars/aad.ODk0NzNmMzItZWQ3Mi03ZDRkLWIxMzYtZjVhNmQ3ZWJhYzYw","descriptor":"aad.ODk0NzNmMzItZWQ3Mi03ZDRkLWIxMzYtZjVhNmQ3ZWJhYzYw"},"modifiedOn":"2021-12-07T14:17:46.067Z","isDeleted":false,"lastRelease":{"id":25,"name":"Release-12","artifacts":[],"_links":{},"description":"","releaseDefinition":{"id":2,"projectReference":null,"_links":{}},"createdOn":"2021-12-07T14:17:50.100Z","createdBy":{"displayName":"Gary Spencer","url":"https://spsprodweu3.vssps.visualstudio.com/Afa44433d-b15b-473b-8914-d9005ae75068/_apis/Identities/89473f32-ed72-6d4d-b136-f5a6d7ebac60","_links":{"avatar":{"href":"https://dev.azure.com/SIS-Betting/_apis/GraphProfile/MemberAvatars/aad.ODk0NzNmMzItZWQ3Mi03ZDRkLWIxMzYtZjVhNmQ3ZWJhYzYw"}},"id":"89473f32-ed72-6d4d-b136-f5a6d7ebac60","uniqueName":"gspencer@sis.tv","imageUrl":"https://dev.azure.com/SIS-Betting/_apis/GraphProfile/MemberAvatars/aad.ODk0NzNmMzItZWQ3Mi03ZDRkLWIxMzYtZjVhNmQ3ZWJhYzYw","descriptor":"aad.ODk0NzNmMzItZWQ3Mi03ZDRkLWIxMzYtZjVhNmQ3ZWJhYzYw"}},"variables":{"businessOwner":{"value":"JPErasmus@sis.tv"},"costCode":{"value":"157-11"},"creationDateTime":{"value":"07/12/2021 14:30"},"environment":{"value":"$(Release.EnvironmentName)"},"technicalOwner":{"value":"gspencer@sis.tv"}},"variableGroups":[293,294],"environments":[{"id":3,"name":"Core","rank":1,"owner":{"displayName":"Gary Spencer","url":"https://spsprodweu3.vssps.visualstudio.com/Afa44433d-b15b-473b-8914-d9005ae75068/_apis/Identities/89473f32-ed72-6d4d-b136-f5a6d7ebac60","_links":{"avatar":{"href":"https://dev.azure.com/SIS-Betting/_apis/GraphProfile/MemberAvatars/aad.ODk0NzNmMzItZWQ3Mi03ZDRkLWIxMzYtZjVhNmQ3ZWJhYzYw"}},"id":"89473f32-ed72-6d4d-b136-f5a6d7ebac60","uniqueName":"gspencer@sis.tv","imageUrl":"https://dev.azure.com/SIS-Betting/_apis/GraphProfile/MemberAvatars/aad.ODk0NzNmMzItZWQ3Mi03ZDRkLWIxMzYtZjVhNmQ3ZWJhYzYw","descriptor":"aad.ODk0NzNmMzItZWQ3Mi03ZDRkLWIxMzYtZjVhNmQ3ZWJhYzYw"},"variables":{"subscriptionId":{"value":"$(subscriptionIdCore)"},"workspaceId":{"value":"$(workspaceIdCore-UKSouth)"},"workspaceKey":{"value":"$(workspaceKeyCore-UKSouth)"}},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":7}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":8},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":9}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"windows-2019"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":1721,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent job","refName":null,"workflowTasks":[{"environment":{},"taskId":"fabce42f-1d38-4004-a1ec-49c90d18e8ea","version":"0.*","name":"Set Variable environment to $(environment) with toLowerCase applied","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"variableName":"environment","value":"$(environment)","transform":"toLowerCase","searchValue":"","newValue":"","indexStart":"","indexEnd":"","regexpExpression":"","regexpMatchNumber":"0","regexpCaseInsensitive":"true","regexpFailNoMatch":"false","regexpReplaceExpression":"","regexpReplaceValue":"","regexpReplaceCaseInsensitive":"true","regexpReplaceReplaceAll":"false"}},{"environment":{},"taskId":"fabce42f-1d38-4004-a1ec-49c90d18e8ea","version":"0.*","name":"Set Variable stateContainerName to $(stateContainerName) with toLowerCase applied","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"variableName":"stateContainerName","value":"$(stateContainerName)","transform":"toLowerCase","searchValue":"","newValue":"","indexStart":"","indexEnd":"","regexpExpression":"","regexpMatchNumber":"0","regexpCaseInsensitive":"true","regexpFailNoMatch":"false","regexpReplaceExpression":"","regexpReplaceValue":"","regexpReplaceCaseInsensitive":"true","regexpReplaceReplaceAll":"false"}},{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"5.*","name":"Create Storage Container","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceNameARM":"0d1b6357-f566-40b5-9d90-5411bc4105cb","ScriptType":"FilePath","ScriptPath":"$(System.DefaultWorkingDirectory)/_AtlassianPostMig/conjirpostmig/PowerShell/createstoragecontainer.ps1","Inline":"# You can write your azure powershell scripts inline here. \n# You can also pass predefined and custom variables to this script using arguments","ScriptArguments":"-keyVaultName $(keyVaultName) -storageAccountName $(storageAccountName) -sasTokenName  $(storageSasTokenName) -stateContainerName $(stateContainerName)","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"LatestVersion","CustomTargetAzurePs":"","pwsh":"false","workingDirectory":""}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"PowerShell Script: creationandreviewdates.ps1","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"filePath","filePath":"$(System.DefaultWorkingDirectory)/_AtlassianPostMig/conjirpostmig/PowerShell/creationandreviewdates.ps1","arguments":"-creationDateTime '$(creationDateTime)' -monthsToAdd '6'","script":"# Write your PowerShell commands here.\n\nWrite-Host \"Hello World\"\n","errorActionPreference":"stop","warningPreference":"default","informationPreference":"default","verbosePreference":"default","debugPreference":"default","failOnStderr":"false","showWarnings":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":"","runScriptInSeparateScope":"false"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"Install Terraform","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"choco install terraform -y\n","errorActionPreference":"stop","warningPreference":"default","informationPreference":"default","verbosePreference":"default","debugPreference":"default","failOnStderr":"false","showWarnings":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":"$(System.DefaultWorkingDirectory)/_AtlassianPostMig/conjirpostmig/Terraform","runScriptInSeparateScope":"false"}},{"environment":{"ARM_CLIENT_ID":"$(clientId)","ARM_CLIENT_SECRET":"$(clientSecret)","ARM_SUBSCRIPTION_ID":"$(subscriptionId)","ARM_TENANT_ID":"$(tenantId)"},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"Terraform Init","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"terraform init -input=false -backend-config=\"storage_account_name=$(storageAccountName)\" -backend-config=\"sas_token=$(storageSasToken)\" -backend-config=\"container_name=$(stateContainerName)\" -backend-config=\"key=$(stateKeyName)\"\n","errorActionPreference":"stop","warningPreference":"default","informationPreference":"default","verbosePreference":"default","debugPreference":"default","failOnStderr":"false","showWarnings":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":"$(System.DefaultWorkingDirectory)/_AtlassianPostMig/conjirpostmig/Terraform","runScriptInSeparateScope":"false"}},{"environment":{"ARM_CLIENT_ID":"$(clientId)","ARM_CLIENT_SECRET":"$(clientSecret)","ARM_SUBSCRIPTION_ID":"$(subscriptionId)","ARM_TENANT_ID":"$(tenantId)","TF_VAR_adminUsername":"$(vm-root-username)","TF_VAR_rootsshRSAPublicKey":"$(vm-root-sshRSAPublicKey)","TF_VAR_serviceReleaseURL":"$(Release.ReleaseWebURL)","TF_VAR_serviceRelease":"$(Release.ReleaseId)","TF_VAR_businessOwner":"$(businessOwner)","TF_VAR_costCode":"$(costCode)","TF_VAR_creationDate":"$(creationDate)","TF_VAR_environment":"$(environment)","TF_VAR_reviewDate":"$(reviewDate)","TF_VAR_technicalOwner":"$(technicalOwner)","TF_VAR_workspaceId":"$(workspaceId)","TF_VAR_workspaceKey":"$(workspaceKey)"},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"Terraform Plan","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"terraform plan -input=false -var-file=\"$(environment).tfvars\" -out=\"$(environment).tfplan\"\n","errorActionPreference":"stop","warningPreference":"default","informationPreference":"default","verbosePreference":"default","debugPreference":"default","failOnStderr":"false","showWarnings":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":"$(System.DefaultWorkingDirectory)/_AtlassianPostMig/conjirpostmig/Terraform","runScriptInSeparateScope":"false"}},{"environment":{"ARM_CLIENT_ID":"$(clientId)","ARM_CLIENT_SECRET":"$(clientSecret)","ARM_SUBSCRIPTION_ID":"$(subscriptionId)","ARM_TENANT_ID":"$(tenantId)","TF_VAR_adminUsername":"$(vm-root-username)","TF_VAR_rootsshRSAPublicKey":"$(vm-root-sshRSAPublicKey)","TF_VAR_serviceReleaseURL":"$(Release.ReleaseWebURL)","TF_VAR_serviceRelease":"$(Release.ReleaseId)","TF_VAR_businessOwner":"$(businessOwner)","TF_VAR_costCode":"$(costCode)","TF_VAR_creationDate":"$(creationDate)","TF_VAR_environment":"$(environment)","TF_VAR_reviewDate":"$(reviewDate)","TF_VAR_technicalOwner":"$(technicalOwner)","TF_VAR_workspaceId":"$(workspaceId)","TF_VAR_workspaceKey":"$(workspaceKey)"},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"Terraform Apply","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"terraform apply -auto-approve \"$(environment).tfplan\"\n","errorActionPreference":"stop","warningPreference":"default","informationPreference":"default","verbosePreference":"default","debugPreference":"default","failOnStderr":"false","showWarnings":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":"$(System.DefaultWorkingDirectory)/_AtlassianPostMig/conjirpostmig/Terraform","runScriptInSeparateScope":"false"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":25,"url":"https://vsrm.dev.azure.com/SIS-Betting/9ea4c8cc-9b6f-406e-a188-e3b015607009/_apis/Release/releases/25","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://vsrm.dev.azure.com/SIS-Betting/_apis/public/Release/badge/9ea4c8cc-9b6f-406e-a188-e3b015607009/2/3"}],"artifacts":[{"sourceId":"9ea4c8cc-9b6f-406e-a188-e3b015607009:668","type":"Build","alias":"_AtlassianPostMig","definitionReference":{"artifactSourceDefinitionUrl":{"id":"https://dev.azure.com/SIS-Betting/_permalink/_build/index?collectionId=d0900d8c-695e-43d4-a594-451d5f931d6a&projectId=9ea4c8cc-9b6f-406e-a188-e3b015607009&definitionId=668","name":""},"defaultVersionBranch":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionTags":{"id":"","name":""},"defaultVersionType":{"id":"latestType","name":"Latest"},"definition":{"id":"668","name":"AtlassianPostMig"},"definitions":{"id":"","name":""},"IsMultiDefinitionType":{"id":"False","name":"False"},"project":{"id":"9ea4c8cc-9b6f-406e-a188-e3b015607009","name":"Atlassian"},"repository":{"id":"","name":""}},"isPrimary":true,"isRetained":false}],"triggers":[],"releaseNameFormat":"Release-$(rev:r)","tags":[],"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"ReleaseNew"},"IntegrateBoardsWorkItems":{"$type":"System.String","$value":"False"},"IntegrateJiraWorkItems":{"$type":"System.String","$value":"false"}},"id":2,"name":"Atlassian Post Migration","path":"\\","projectReference":null,"url":"https://vsrm.dev.azure.com/SIS-Betting/9ea4c8cc-9b6f-406e-a188-e3b015607009/_apis/Release/definitions/2","_links":{"self":{"href":"https://vsrm.dev.azure.com/SIS-Betting/9ea4c8cc-9b6f-406e-a188-e3b015607009/_apis/Release/definitions/2"},"web":{"href":"https://dev.azure.com/SIS-Betting/9ea4c8cc-9b6f-406e-a188-e3b015607009/_release?definitionId=2"}}}